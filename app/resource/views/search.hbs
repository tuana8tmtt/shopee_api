<div class="container">
    <form action="{{current_url}}/search">

        <div class="input-group">

            <input name="keyword" value="{{keyword}}" type="text" class="form-control" placeholder="Search this blog">
            <div class="input-group-append">
                <button class="btn btn-secondary" type="button">
                    <i class="fa fa-search"></i>
                </button>
            </div>
        </div>

    </form>



    <div class="mt-2">
        <div class="form-group">
            <span>Đã tìm thấy <b id="total">{{data_count}}</b> sản phẩm với từ khóa "{{keyword}}"</span>
        </div>
    </div>
    <div class="row result">
        <div id="result" class="row mt-2 ">
            {{#each items}}

            <div class="col-sm-3 col-lg-3">
                <a href="product/{{this.slug}}" class="order">
                    <div class="card mt-4">
                        <img class="card-img-top" src="https://cf.shopee.vn/file/{{this.image}}" alt="Card image cap">
                        <div class="card-body">
                            <span class="name">
                                {{this.name}}
                            </span>
                            <div class="discount">
                                <i className="icon bi-envelope"></i>

                                {{#if (isDiscount this.price_before_discount)}}
                                <span class="badge badge-success m-0">{{this.discount}}</span>
                                {{/if}}
                            </div>

                            <div class="price">
                                {{#if (isDiscount this.price_before_discount)}}
                                <div class="del">
                                    <del>
                                        <span>₫{{format_number
                                            this.price_before_discount}}
                                        </span></del>
                                </div>
                                <div class="real">
                                    <span class="">₫{{format_number this.price}}</span>
                                </div>

                                {{else}}
                                <span style="color:red" class="">₫{{format_number this.price}}</span>

                                {{/if}}
                            </div>
                            <div class="status">
                                <div class="sold">
                                    <span>Đã bán {{this.sold}}</span>
                                </div>
                            </div>
                            <div class="address">
                                <div class="ship">
                                    {{this.shop_localtion}}
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        class="bi bi-truck" viewBox="0 0 16 16">
                                        <path
                                            d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5v-7zm1.294 7.456A1.999 1.999 0 0 1 4.732 11h5.536a2.01 2.01 0 0 1 .732-.732V3.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .294.456zM12 10a2 2 0 0 1 1.732 1h.768a.5.5 0 0 0 .5-.5V8.35a.5.5 0 0 0-.11-.312l-1.48-1.85A.5.5 0 0 0 13.02 6H12v4zm-9 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm9 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z">
                                        </path>
                                    </svg>

                                </div>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
            {{/each}}
        </div>

        {{!--
    </div>
    <script src="https://cdn.jsdelivr.net/npm/lazyload@2.0.0-rc.2/lazyload.js"></script>
    <script>
        lazyload();

    </script> --}}

    <script>
        var x = 0;
        document.addEventListener("DOMContentLoaded", () => {
            //set up the IntersectionObserver to load more images if the footer is visible.
            //URL - https://gist.githubusercontent.com/prof3ssorSt3v3/1944e7ba7ffb62fe771c51764f7977a4/raw/c58a342ab149fbbb9bb19c94e278d64702833270/infinite.json
            let options = {
                root: null,
                rootMargins: "0px",
                threshold: 0.5
            };
            const observer = new IntersectionObserver(handleIntersect, options);
            observer.observe(document.querySelector("footer"));
            //an initial load of some data
            getData();
        });
        function handleIntersect(entries) {
            if (entries[0].isIntersecting) {
                console.warn("something is intersecting with the viewport");
                getData();
            }
        }

        function getData() {
            document.getElementById('loading').style.display = 'block';
            const URL = '{{ current_url }}/api/v1.0/products?key_word={{encode_keyword}}&limit=12&newest=' + x * 12;
            let main = document.getElementById("result");
            fetch(URL)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('total').innerHTML = number_fomart(data.count);

                    // data.items[].img, data.items[].name
                    data.items.forEach(item => {
                        let col = document.createElement('div');
                        col.className = 'col-sm-3 col-lg-3';
                        let order = document.createElement('a');
                        order.className = 'order';
                        let card = document.createElement('div')
                        card.className = 'card mt-4 mb-4';
                        let cardimgtop = document.createElement('img');
                        cardimgtop.className = 'card-img-top';
                        cardimgtop.src = 'https://cf.shopee.vn/file/' + item.image;
                        let cardbody = document.createElement('div');
                        cardbody.className = 'card-body';
                        let namespan = document.createElement('span')
                        namespan.className = 'name';
                        namespan.innerHTML = item.name;
                        cardbody.appendChild(namespan);

                        let discount = document.createElement('div');
                        discount.className = 'discount';

                        let iIconBienvelope = document.createElement('i')
                        iIconBienvelope.className = 'icon bi-envelope';
                        let badge = document.createElement('span');
                        badge.className = 'badge badge-success m-0';
                        badge.innerHTML = item.discount;
                        discount.appendChild(iIconBienvelope);
                        discount.appendChild(badge);

                        let price = document.createElement('div');
                        price.className = 'price';
                        let delDiv = document.createElement('div')
                        let del = document.createElement('del')
                        let real = document.createElement('div')
                        delDiv.className = 'del';
                        del.innerHTML = number_fomart(item.price_before_discount);
                        real.className = 'real';



                        if (item.price_before_discount != 0) {
                            delDiv.appendChild(del);
                            price.appendChild(del);
                            real.innerHTML = number_fomart(item.price);
                            price.appendChild(real);
                        } else {
                            realspan = document.createElement('span');
                            realspan.innerHTML = number_fomart(item.price);
                            realspan.style.color = 'red';
                            price.appendChild(realspan);
                        }
                        let status = document.createElement('div');
                        status.className = 'status';
                        let sold = document.createElement('div');
                        sold.className = 'sold';
                        sold.innerHTML = 'Đã bán ' + item.sold;
                        status.appendChild(sold);

                        let address = document.createElement('div');
                        address.className = 'address';
                        let ship = document.createElement('div');
                        ship.className = 'ship';
                        ship.innerHTML = item.shop_localtion;
                        let star = document.createElement('div');
                        star.className = "star-icon-search";
                        star.innerHTML = '<svg xmlns = "http://www.w3.org/2000/svg" width = "16" height = "16" fill = "currentColor"class="bi bi-star-fill" viewBox = "0 0 16 16" > <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" /></svg > <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16" ><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" /></svg > <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"class="bi bi-star-fill" viewBox = "0 0 16 16" ><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" /></svg > <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"class="bi bi-star-fill" viewBox = "0 0 16 16" ><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" /></svg > <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"class="bi bi-star-fill" viewBox = "0 0 16 16" ><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" /></svg > '

                        address.appendChild(ship);
                        cardbody.appendChild(discount);
                        cardbody.appendChild(price);
                        cardbody.appendChild(status);
                        cardbody.appendChild(address);

                        card.appendChild(cardimgtop);
                        card.appendChild(star);
                        card.appendChild(cardbody)
                        order.appendChild(card)
                        order.href = '{{ current_url }}/product/' + item.slug;
                        col.appendChild(order);
                        main.appendChild(col)

                    });
                    document.getElementById('loading').style.display = 'block';

                });
            x++;
        }
        function number_fomart(value) {
            return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }
    </script>